!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||0>n||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(er=arguments[1],er instanceof Error)throw er;throw TypeError('Uncaught, unspecified "error" event.')}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:for(len=arguments.length,args=new Array(len-1),i=1;len>i;i++)args[i-1]=arguments[i];handler.apply(this,args)}else if(isObject(handler)){for(len=arguments.length,args=new Array(len-1),i=1;len>i;i++)args[i-1]=arguments[i];for(listeners=handler.slice(),len=listeners.length,i=0;len>i;i++)listeners[i].apply(this,args)}return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned){var m;m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,m&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-->0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(0>position)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){var ret;return ret=this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.listenerCount=function(emitter,type){var ret;return ret=emitter._events&&emitter._events[type]?isFunction(emitter._events[type])?1:emitter._events[type].length:0}},{}],2:[function(require,module,exports){(function(global){(function(){function runInContext(context,exports){function has(name){if(has[name]!==undef)return has[name];var isSupported;if("bug-string-char-index"==name)isSupported="a"!="a"[0];else if("json"==name)isSupported=has("json-stringify")&&has("json-parse");else{var value,serialized='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==name){var stringify=exports.stringify,stringifySupported="function"==typeof stringify&&isExtended;if(stringifySupported){(value=function(){return 1}).toJSON=value;try{stringifySupported="0"===stringify(0)&&"0"===stringify(new Number)&&'""'==stringify(new String)&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&"1"===stringify(value)&&"[1]"==stringify([value])&&"[null]"==stringify([undef])&&"null"==stringify(null)&&"[null,null,null]"==stringify([undef,getClass,null])&&stringify({a:[value,!0,!1,null,"\x00\b\n\f\r	"]})==serialized&&"1"===stringify(null,value)&&"[\n 1,\n 2\n]"==stringify([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==stringify(new Date(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==stringify(new Date(864e13))&&'"-000001-01-01T00:00:00.000Z"'==stringify(new Date(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==stringify(new Date(-1))}catch(exception){stringifySupported=!1}}isSupported=stringifySupported}if("json-parse"==name){var parse=exports.parse;if("function"==typeof parse)try{if(0===parse("0")&&!parse(!1)){value=parse(serialized);var parseSupported=5==value.a.length&&1===value.a[0];if(parseSupported){try{parseSupported=!parse('"	"')}catch(exception){}if(parseSupported)try{parseSupported=1!==parse("01")}catch(exception){}if(parseSupported)try{parseSupported=1!==parse("1.")}catch(exception){}}}}catch(exception){parseSupported=!1}isSupported=parseSupported}}return has[name]=!!isSupported}context||(context=root.Object()),exports||(exports=root.Object());var Number=context.Number||root.Number,String=context.String||root.String,Object=context.Object||root.Object,Date=context.Date||root.Date,SyntaxError=context.SyntaxError||root.SyntaxError,TypeError=context.TypeError||root.TypeError,Math=context.Math||root.Math,nativeJSON=context.JSON||root.JSON;"object"==typeof nativeJSON&&nativeJSON&&(exports.stringify=nativeJSON.stringify,exports.parse=nativeJSON.parse);var isProperty,forEach,undef,objectProto=Object.prototype,getClass=objectProto.toString,isExtended=new Date(-0xc782b5b800cec);try{isExtended=-109252==isExtended.getUTCFullYear()&&0===isExtended.getUTCMonth()&&1===isExtended.getUTCDate()&&10==isExtended.getUTCHours()&&37==isExtended.getUTCMinutes()&&6==isExtended.getUTCSeconds()&&708==isExtended.getUTCMilliseconds()}catch(exception){}if(!has("json")){var functionClass="[object Function]",dateClass="[object Date]",numberClass="[object Number]",stringClass="[object String]",arrayClass="[object Array]",booleanClass="[object Boolean]",charIndexBuggy=has("bug-string-char-index");if(!isExtended)var floor=Math.floor,Months=[0,31,59,90,120,151,181,212,243,273,304,334],getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)};if((isProperty=objectProto.hasOwnProperty)||(isProperty=function(property){var constructor,members={};return(members.__proto__=null,members.__proto__={toString:1},members).toString!=getClass?isProperty=function(property){var original=this.__proto__,result=property in(this.__proto__=null,this);return this.__proto__=original,result}:(constructor=members.constructor,isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property])}),members=null,isProperty.call(this,property)}),forEach=function(object,callback){var Properties,members,property,size=0;(Properties=function(){this.valueOf=0}).prototype.valueOf=0,members=new Properties;for(property in members)isProperty.call(members,property)&&size++;return Properties=members=null,size?forEach=2==size?function(object,callback){var property,members={},isFunction=getClass.call(object)==functionClass;for(property in object)isFunction&&"prototype"==property||isProperty.call(members,property)||!(members[property]=1)||!isProperty.call(object,property)||callback(property)}:function(object,callback){var property,isConstructor,isFunction=getClass.call(object)==functionClass;for(property in object)isFunction&&"prototype"==property||!isProperty.call(object,property)||(isConstructor="constructor"===property)||callback(property);(isConstructor||isProperty.call(object,property="constructor"))&&callback(property)}:(members=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],forEach=function(object,callback){var property,length,isFunction=getClass.call(object)==functionClass,hasProperty=!isFunction&&"function"!=typeof object.constructor&&objectTypes[typeof object.hasOwnProperty]&&object.hasOwnProperty||isProperty;for(property in object)isFunction&&"prototype"==property||!hasProperty.call(object,property)||callback(property);for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property));}),forEach(object,callback)},!has("json-stringify")){var Escapes={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},leadingZeroes="000000",toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width)},unicodePrefix="\\u00",quote=function(value){for(var result='"',index=0,length=value.length,useCharIndex=!charIndexBuggy||length>10,symbols=useCharIndex&&(charIndexBuggy?value.split(""):value);length>index;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(32>charCode){result+=unicodePrefix+toPaddedString(2,charCode.toString(16));break}result+=useCharIndex?symbols[index]:value.charAt(index)}}return result+'"'},serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,result;try{value=object[property]}catch(exception){}if("object"==typeof value&&value)if(className=getClass.call(value),className!=dateClass||isProperty.call(value,"toJSON"))"function"==typeof value.toJSON&&(className!=numberClass&&className!=stringClass&&className!=arrayClass||isProperty.call(value,"toJSON"))&&(value=value.toJSON(property));else if(value>-1/0&&1/0>value){if(getDay){for(date=floor(value/864e5),year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month),time=(value%864e5+864e5)%864e5,hours=floor(time/36e5)%24,minutes=floor(time/6e4)%60,seconds=floor(time/1e3)%60,milliseconds=time%1e3}else year=value.getUTCFullYear(),month=value.getUTCMonth(),date=value.getUTCDate(),hours=value.getUTCHours(),minutes=value.getUTCMinutes(),seconds=value.getUTCSeconds(),milliseconds=value.getUTCMilliseconds();value=(0>=year||year>=1e4?(0>year?"-":"+")+toPaddedString(6,0>year?-year:year):toPaddedString(4,year))+"-"+toPaddedString(2,month+1)+"-"+toPaddedString(2,date)+"T"+toPaddedString(2,hours)+":"+toPaddedString(2,minutes)+":"+toPaddedString(2,seconds)+"."+toPaddedString(3,milliseconds)+"Z"}else value=null;if(callback&&(value=callback.call(object,property,value)),null===value)return"null";if(className=getClass.call(value),className==booleanClass)return""+value;if(className==numberClass)return value>-1/0&&1/0>value?""+value:"null";if(className==stringClass)return quote(""+value);if("object"==typeof value){for(length=stack.length;length--;)if(stack[length]===value)throw TypeError();if(stack.push(value),results=[],prefix=indentation,indentation+=whitespace,className==arrayClass){for(index=0,length=value.length;length>index;index++)element=serialize(index,value,callback,properties,whitespace,indentation,stack),results.push(element===undef?"null":element);result=results.length?whitespace?"[\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"]":"["+results.join(",")+"]":"[]"}else forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);element!==undef&&results.push(quote(property)+":"+(whitespace?" ":"")+element)}),result=results.length?whitespace?"{\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"}":"{"+results.join(",")+"}":"{}";return stack.pop(),result}};exports.stringify=function(source,filter,width){var whitespace,callback,properties,className;if(objectTypes[typeof filter]&&filter)if((className=getClass.call(filter))==functionClass)callback=filter;else if(className==arrayClass){properties={};for(var value,index=0,length=filter.length;length>index;value=filter[index++],className=getClass.call(value),(className==stringClass||className==numberClass)&&(properties[value]=1));}if(width)if((className=getClass.call(width))==numberClass){if((width-=width%1)>0)for(whitespace="",width>10&&(width=10);whitespace.length<width;whitespace+=" ");}else className==stringClass&&(whitespace=width.length<=10?width:width.slice(0,10));return serialize("",(value={},value[""]=source,value),callback,properties,whitespace,"",[])}}if(!has("json-parse")){var Index,Source,fromCharCode=String.fromCharCode,Unescapes={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},abort=function(){throw Index=Source=null,SyntaxError()},lex=function(){for(var value,begin,position,isSigned,charCode,source=Source,length=source.length;length>Index;)switch(charCode=source.charCodeAt(Index)){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:return value=charIndexBuggy?source.charAt(Index):source[Index],Index++,value;case 34:for(value="@",Index++;length>Index;)if(charCode=source.charCodeAt(Index),32>charCode)abort();else if(92==charCode)switch(charCode=source.charCodeAt(++Index)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode],Index++;break;case 117:for(begin=++Index,position=Index+4;position>Index;Index++)charCode=source.charCodeAt(Index),charCode>=48&&57>=charCode||charCode>=97&&102>=charCode||charCode>=65&&70>=charCode||abort();value+=fromCharCode("0x"+source.slice(begin,Index));break;default:abort()}else{if(34==charCode)break;for(charCode=source.charCodeAt(Index),begin=Index;charCode>=32&&92!=charCode&&34!=charCode;)charCode=source.charCodeAt(++Index);value+=source.slice(begin,Index)}if(34==source.charCodeAt(Index))return Index++,value;abort();default:if(begin=Index,45==charCode&&(isSigned=!0,charCode=source.charCodeAt(++Index)),charCode>=48&&57>=charCode){for(48==charCode&&(charCode=source.charCodeAt(Index+1),charCode>=48&&57>=charCode)&&abort(),isSigned=!1;length>Index&&(charCode=source.charCodeAt(Index),charCode>=48&&57>=charCode);Index++);if(46==source.charCodeAt(Index)){for(position=++Index;length>position&&(charCode=source.charCodeAt(position),charCode>=48&&57>=charCode);position++);position==Index&&abort(),Index=position}if(charCode=source.charCodeAt(Index),101==charCode||69==charCode){for(charCode=source.charCodeAt(++Index),(43==charCode||45==charCode)&&Index++,position=Index;length>position&&(charCode=source.charCodeAt(position),charCode>=48&&57>=charCode);position++);position==Index&&abort(),Index=position}return+source.slice(begin,Index)}if(isSigned&&abort(),"true"==source.slice(Index,Index+4))return Index+=4,!0;if("false"==source.slice(Index,Index+5))return Index+=5,!1;if("null"==source.slice(Index,Index+4))return Index+=4,null;abort()}return"$"},get=function(value){var results,hasMembers;if("$"==value&&abort(),"string"==typeof value){if("@"==(charIndexBuggy?value.charAt(0):value[0]))return value.slice(1);if("["==value){for(results=[];value=lex(),"]"!=value;hasMembers||(hasMembers=!0))hasMembers&&(","==value?(value=lex(),"]"==value&&abort()):abort()),","==value&&abort(),results.push(get(value));return results}if("{"==value){for(results={};value=lex(),"}"!=value;hasMembers||(hasMembers=!0))hasMembers&&(","==value?(value=lex(),"}"==value&&abort()):abort()),(","==value||"string"!=typeof value||"@"!=(charIndexBuggy?value.charAt(0):value[0])||":"!=lex())&&abort(),results[value.slice(1)]=get(lex());return results}abort()}return value},update=function(source,property,callback){var element=walk(source,property,callback);element===undef?delete source[property]:source[property]=element},walk=function(source,property,callback){var length,value=source[property];if("object"==typeof value&&value)if(getClass.call(value)==arrayClass)for(length=value.length;length--;)update(value,length,callback);else forEach(value,function(property){update(value,property,callback)});return callback.call(source,property,value)};exports.parse=function(source,callback){var result,value;return Index=0,Source=""+source,result=get(lex()),"$"!=lex()&&abort(),Index=Source=null,callback&&getClass.call(callback)==functionClass?walk((value={},value[""]=result,value),"",callback):result}}}return exports.runInContext=runInContext,exports}var isLoader="function"==typeof define&&define.amd,objectTypes={"function":!0,object:!0},freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports,root=objectTypes[typeof window]&&window||this,freeGlobal=freeExports&&objectTypes[typeof module]&&module&&!module.nodeType&&"object"==typeof global&&global;if(!freeGlobal||freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal&&freeGlobal.self!==freeGlobal||(root=freeGlobal),freeExports&&!isLoader)runInContext(root,freeExports);else{var nativeJSON=root.JSON,previousJSON=root.JSON3,isRestored=!1,JSON3=runInContext(root,root.JSON3={noConflict:function(){return isRestored||(isRestored=!0,root.JSON=nativeJSON,root.JSON3=previousJSON,nativeJSON=previousJSON=null),JSON3}});root.JSON={parse:JSON3.parse,stringify:JSON3.stringify}}isLoader&&define(function(){return JSON3})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(require,module,exports){(function(__filename){!function(root){var Yaku;return Yaku=function(){"use strict";function Yaku(executor){var err;isLongStackTrace&&(this[$promiseTrace]=genTraceInfo()),executor!==$noop&&(err=genTryCatcher(executor)(genSettler(this,$resolved),genSettler(this,$rejected)),err===$tryErr&&settlePromise(this,$rejected,err.e))}var $circularChain,$fromPrevious,$invalid_argument,$nil,$noop,$pending,$promiseTrace,$rejected,$resolved,$settlerTrace,$tryCatchFn,$tryErr,addHandler,assertIterable,callHanler,genScheduler,genSettler,genStackInfo,genTraceInfo,genTryCatcher,genTypeError,getThen,isFunction,isLongStackTrace,isObject,newEmptyYaku,release,scheduleHandler,scheduleUnhandledRejection,settlePromise,settleWithX,settleXthen,tryCatcher;Yaku.prototype.then=function(onFulfilled,onRejected){return addHandler(this,newEmptyYaku(),onFulfilled,onRejected)},Yaku.prototype["catch"]=function(onRejected){return this.then($nil,onRejected)},Yaku.resolve=function(value){return value instanceof Yaku?value:settleWithX(newEmptyYaku(),value)},Yaku.reject=function(reason){return settlePromise(newEmptyYaku(),$rejected,reason)},Yaku.race=function(iterable){var i,len,p;if(assertIterable(iterable),len=iterable.length,0===len)return Yaku.resolve([]);for(p=newEmptyYaku(),i=0;len>i&&(settleWithX(p,iterable[i++]),p._state===$pending););return p},Yaku.all=function(iterable){var convertor,countDown,i,iter,len,onRejected,p1,res;if(assertIterable(iterable),convertor=Yaku.resolve,len=countDown=iterable.length,0===len)return convertor([]);for(p1=newEmptyYaku(),res=[],i=0,onRejected=function(reason){settlePromise(p1,$rejected,reason)},iter=function(i){convertor(iterable[i]).then(function(value){res[i]=value,--countDown||settlePromise(p1,$resolved,res)},onRejected)};len>i;)iter(i++);return p1},Yaku.onUnhandledRejection=function(reason,p){var info;if(isObject(console))return info=genStackInfo(reason,p),console.error("Unhandled Rejection:",info[0],info[1])},isLongStackTrace=!1,Yaku.enableLongStackTrace=function(){isLongStackTrace=!0},$tryCatchFn=null,$tryErr={e:null},$noop={},$nil=void 0,isObject=function(obj){return"object"==typeof obj},isFunction=function(obj){return"function"==typeof obj},release=function(obj,key){obj[key]=$nil},tryCatcher=function(){var e;try{return $tryCatchFn.apply(this,arguments)}catch(_error){return e=_error,$tryErr.e=e,$tryErr}},genTryCatcher=function(fn){return $tryCatchFn=fn,tryCatcher},genScheduler=function(initQueueSize,fn){var flush,fnQueue,fnQueueLen,scheduleFlush;return fnQueue=Array(initQueueSize),fnQueueLen=0,flush=function(){var i,p,pIndex,v,vIndex;for(i=0;fnQueueLen>i;)pIndex=i++,vIndex=i++,p=fnQueue[pIndex],v=fnQueue[vIndex],release(fnQueue,pIndex),release(fnQueue,vIndex),fn(p,v);fnQueueLen=0,fnQueue.length=initQueueSize},scheduleFlush=function(){var content,doc,mutationObserver,nextTick,node,observer;doc=root.document;try{return nextTick=root.process.nextTick,function(){nextTick(flush)}}catch(_error){}return(nextTick=root.setImmediate)?function(){nextTick(flush)}:(mutationObserver=root.MutationObserver)?(content=1,node=doc.createTextNode(""),observer=new mutationObserver(flush),observer.observe(node,{characterData:!0}),function(){node.data=content=-content}):function(){setTimeout(flush)}}(),function(p,v){fnQueue[fnQueueLen++]=p,fnQueue[fnQueueLen++]=v,2===fnQueueLen&&scheduleFlush()}},assertIterable=function(obj){if(!(obj instanceof Array))throw genTypeError($invalid_argument)},genTypeError=function(msg){return new TypeError(msg)},genTraceInfo=function(noTitle){return(new Error).stack.replace("Error",noTitle?"":$fromPrevious)},$rejected=0,$resolved=1,$pending=2,$promiseTrace="_pStack",$settlerTrace="_sStack",$circularChain="promise_circular_chain",$invalid_argument="invalid_argument",$fromPrevious="From previous event:",Yaku.prototype._state=$pending,Yaku.prototype._pCount=0,Yaku.prototype._pre=null,newEmptyYaku=function(){return new Yaku($noop)},genSettler=function(self,state){return function(value){isLongStackTrace&&(self[$settlerTrace]=genTraceInfo(!0)),state===$resolved?settleWithX(self,value):settlePromise(self,state,value)}},addHandler=function(p1,p2,onFulfilled,onRejected){return isFunction(onFulfilled)&&(p2._onFulfilled=onFulfilled),isFunction(onRejected)&&(p2._onRejected=onRejected),p2._pre=p1,p1[p1._pCount++]=p2,p1._state!==$pending&&scheduleHandler(p1,p2),p2},scheduleHandler=genScheduler(1e3,function(p1,p2){var handler,x;return handler=p1._state?p2._onFulfilled:p2._onRejected,handler===$nil?void settlePromise(p2,p1._state,p1._value):(x=genTryCatcher(callHanler)(handler,p1._value),x===$tryErr?void settlePromise(p2,$rejected,x.e):void settleWithX(p2,x))}),scheduleUnhandledRejection=genScheduler(100,function(p){var iter;iter=function(node){var i,len;if(i=0,len=node._pCount,!node._onRejected){for(;len>i;)if(!iter(node[i++]))return;return!0}},iter(p)&&Yaku.onUnhandledRejection(p._value,p)}),genStackInfo=function(reason,p){var clean,iter,push,stackInfo,stackStr,trim;return stackInfo=[],trim=function(str){return str.replace(/^\s+|\s+$/g,"")},isLongStackTrace&&p[$promiseTrace]&&(push=function(trace){return stackInfo.push(trim(trace))},p[$settlerTrace]&&push(p[$settlerTrace]),(iter=function(node){return node?(iter(node._next),push(node[$promiseTrace]),iter(node._pre)):void 0})(p)),stackStr="\n"+stackInfo.join("\n"),clean=function(stack,cleanPrev){var i;return cleanPrev&&(i=stack.indexOf("\n"+$fromPrevious))>0&&(stack=stack.slice(0,i)),"string"==typeof __filename?stack.replace(RegExp(".+"+__filename+".+\\n?","g"),""):void 0},[reason&&reason.stack?clean(trim(reason.stack),!0):reason,clean(stackStr)]},callHanler=function(handler,value){return handler(value)},settlePromise=function(p,state,value){var i,len,stack;if(p._state===$pending){for(p._state=state,p._value=value,state===$rejected&&(isLongStackTrace&&value&&value.stack&&(stack=genStackInfo(value,p),value.stack=stack[0]+stack[1]),p._pre&&p._pre._state!==$resolved||scheduleUnhandledRejection(p)),i=0,len=p._pCount;len>i;)scheduleHandler(p,p[i++]);return p}},settleWithX=function(p,x){var xthen;if(x===p&&x)return void settlePromise(p,$rejected,genTypeError($circularChain));if(null!==x&&(isFunction(x)||isObject(x))){if(xthen=genTryCatcher(getThen)(x),xthen===$tryErr)return void settlePromise(p,$rejected,xthen.e);isFunction(xthen)?(isLongStackTrace&&x instanceof Yaku&&(p._next=x),settleXthen(p,x,xthen)):settlePromise(p,$resolved,x)}else settlePromise(p,$resolved,x);return p},getThen=function(x){return x.then},settleXthen=function(p,x,xthen){var err;err=genTryCatcher(xthen).call(x,function(y){x&&(x=null,settleWithX(p,y))},function(r){x&&(x=null,settlePromise(p,$rejected,r))}),err===$tryErr&&x&&(settlePromise(p,$rejected,err.e),x=null)};try{module.exports=Yaku}catch(_error){try{define(function(){return Yaku})}catch(_error){root.Yaku=Yaku}}return Yaku}()}(this||window)}).call(this,"/node_modules/yaku/lib/yaku.js")},{}],4:[function(require,module,exports){var Answer,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Answer=function(superClass){function Answer(){return Answer.__super__.constructor.apply(this,arguments)}return extend(Answer,superClass),module.exports=Answer,Answer.path="/channel/answers",Answer.association("question",require("./question")),Answer}(require("../resource"))},{"../resource":27,"./question":18}],5:[function(require,module,exports){var Booking,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Booking=function(superClass){function Booking(){return Booking.__super__.constructor.apply(this,arguments)}return extend(Booking,superClass),module.exports=Booking,Booking.path="/channel/bookings",Booking.types({ticket:require("./booking/ticket"),voucher:require("./booking/voucher")}),Booking.collection("tiers",require("./tier")),Booking.collection("answers",require("./answer")),Booking.collection("purchases",require("./purchase")),Booking}(require("../resource"))},{"../resource":27,"./answer":4,"./booking/ticket":6,"./booking/voucher":7,"./purchase":17,"./tier":20}],6:[function(require,module,exports){var TicketBooking,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;TicketBooking=function(superClass){function TicketBooking(){return TicketBooking.__super__.constructor.apply(this,arguments)}return extend(TicketBooking,superClass),module.exports=TicketBooking,TicketBooking.path="/channel/bookings",TicketBooking.collection("tickets",require("../ticket")),TicketBooking}(require("../booking"))},{"../booking":5,"../ticket":19}],7:[function(require,module,exports){var VoucherBooking,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;VoucherBooking=function(superClass){function VoucherBooking(){return VoucherBooking.__super__.constructor.apply(this,arguments)}return extend(VoucherBooking,superClass),module.exports=VoucherBooking,VoucherBooking.path="/channel/bookings",VoucherBooking.collection("vouchers",require("../voucher")),VoucherBooking}(require("../booking"))},{"../booking":5,"../voucher":22}],8:[function(require,module,exports){var Channel,TicketingHub,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;TicketingHub=require("../ticketinghub"),Channel=function(superClass){function Channel(){return Channel.__super__.constructor.apply(this,arguments)}return extend(Channel,superClass),module.exports=Channel,Channel.path="/channel",Channel.singleton=!0,Channel.collection("vouchers",require("./voucher")),Channel.collection("coupons",require("./coupon")),Channel.collection("tiers",require("./tier")),Channel.collection("variants",require("./variant")),Channel.collection("extras",require("./extra")),Channel.collection("questions",require("./question")),Channel.collection("bookings",require("./booking")),Channel.collection("orders",require("./order")),Channel.collection("options",require("./option")),Channel.association("product",require("./product")),Channel.login=function(token){return TicketingHub.endpoint.base(this.path,token).get().then(function(_this){return function(response){return _this.load(TicketingHub.endpoint.join(_this.path,token),response.body)}}(this))},Channel}(require("../resource"))},{"../resource":27,"../ticketinghub":29,"./booking":5,"./coupon":9,"./extra":10,"./option":11,"./order":12,"./product":16,"./question":18,"./tier":20,"./variant":21,"./voucher":22}],9:[function(require,module,exports){var Coupon,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Coupon=function(superClass){function Coupon(){return Coupon.__super__.constructor.apply(this,arguments)}return extend(Coupon,superClass),module.exports=Coupon,Coupon.path="/channel/coupons",Coupon}(require("../resource"))},{"../resource":27}],10:[function(require,module,exports){var Extra,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Extra=function(superClass){function Extra(){return Extra.__super__.constructor.apply(this,arguments)}return extend(Extra,superClass),module.exports=Extra,Extra.path="/channel/extras",Extra}(require("../resource"))},{"../resource":27}],11:[function(require,module,exports){var Option,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Option=function(superClass){
function Option(){return Option.__super__.constructor.apply(this,arguments)}return extend(Option,superClass),module.exports=Option,Option.path="/channel/options",Option}(require("../resource"))},{"../resource":27}],12:[function(require,module,exports){var Order,TicketingHub,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;TicketingHub=require("../ticketinghub"),Order=function(superClass){function Order(){return Order.__super__.constructor.apply(this,arguments)}return extend(Order,superClass),module.exports=Order,Order.path="/channel/orders",Order.collection("payments",require("./payment")),Order.collection("bookings",require("./booking")),Order.prototype.confirm=function(){return this._endpoint.post("confirm").then(function(_this){return function(response){return _this._setup(response.body)}}(this))["catch"](function(_this){return function(error){throw error instanceof TicketingHub.RequestError||422===error.response.status?new TicketingHub.ValidationError(_this.constructor.load(_this._endpoint,error.response.body)):error}}(this))},Order}(require("../resource"))},{"../resource":27,"../ticketinghub":29,"./booking":5,"./payment":13}],13:[function(require,module,exports){var Payment,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Payment=function(superClass){function Payment(){return Payment.__super__.constructor.apply(this,arguments)}return extend(Payment,superClass),module.exports=Payment,Payment.path="/channel/payments",Payment.types({credit:require("./payment/credit"),stripe:require("./payment/stripe")}),Payment}(require("../resource"))},{"../resource":27,"./payment/credit":14,"./payment/stripe":15}],14:[function(require,module,exports){var CreditPayment,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;CreditPayment=function(superClass){function CreditPayment(){return CreditPayment.__super__.constructor.apply(this,arguments)}return extend(CreditPayment,superClass),module.exports=CreditPayment,CreditPayment.path="/channel/payments",CreditPayment}(require("../payment"))},{"../payment":13}],15:[function(require,module,exports){var StripePayment,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;StripePayment=function(superClass){function StripePayment(){return StripePayment.__super__.constructor.apply(this,arguments)}return extend(StripePayment,superClass),module.exports=StripePayment,StripePayment.path="/channel/payments",StripePayment}(require("../payment"))},{"../payment":13}],16:[function(require,module,exports){var Product,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Product=function(superClass){function Product(){return Product.__super__.constructor.apply(this,arguments)}return extend(Product,superClass),module.exports=Product,Product.path="/channel/product",Product.singleton=!0,Product}(require("../resource"))},{"../resource":27}],17:[function(require,module,exports){var Purchase,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Purchase=function(superClass){function Purchase(){return Purchase.__super__.constructor.apply(this,arguments)}return extend(Purchase,superClass),module.exports=Purchase,Purchase.path="/channel/purchases",Purchase.association("extra",require("./extra")),Purchase}(require("../resource"))},{"../resource":27,"./extra":10}],18:[function(require,module,exports){var Question,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Question=function(superClass){function Question(){return Question.__super__.constructor.apply(this,arguments)}return extend(Question,superClass),module.exports=Question,Question.path="/channel/questions",Question}(require("../resource"))},{"../resource":27}],19:[function(require,module,exports){var Ticket,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Ticket=function(superClass){function Ticket(){return Ticket.__super__.constructor.apply(this,arguments)}return extend(Ticket,superClass),module.exports=Ticket,Ticket.path="/channel/tickets",Ticket}(require("../resource"))},{"../resource":27}],20:[function(require,module,exports){var Tier,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Tier=function(superClass){function Tier(){return Tier.__super__.constructor.apply(this,arguments)}return extend(Tier,superClass),module.exports=Tier,Tier.path="/channel/tiers",Tier}(require("../resource"))},{"../resource":27}],21:[function(require,module,exports){var Variant,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Variant=function(superClass){function Variant(){return Variant.__super__.constructor.apply(this,arguments)}return extend(Variant,superClass),module.exports=Variant,Variant.path="/channel/variants",Variant}(require("../resource"))},{"../resource":27}],22:[function(require,module,exports){var Voucher,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Voucher=function(superClass){function Voucher(){return Voucher.__super__.constructor.apply(this,arguments)}return extend(Voucher,superClass),module.exports=Voucher,Voucher.path="/channel/vouchers",Voucher}(require("../resource"))},{"../resource":27}],23:[function(require,module,exports){var Collection,EventEmitter,TicketingHub,extend,extend1=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,slice=[].slice;extend=require("./util").extend,TicketingHub=require("./ticketinghub"),EventEmitter=require("events").EventEmitter,Collection=function(superClass){function Collection(endpoint,klass,params){this.endpoint=endpoint,this.klass=klass,Collection.__super__.constructor.call(this),this._params=extend({},params||{}),this._limit=this._params.limit||MAX_LIMIT,this._offset=this._params.offset||0}var MAX_LIMIT,fn,i,len,method,ref;for(extend1(Collection,superClass),module.exports=Collection,MAX_LIMIT=25,Collection.prototype.each=function(callback){var dispatch,fetch,index;return index=0,dispatch=function(_this){return function(cache){var i,len,loaded,value;for(i=0,len=cache.length;len>i;i++)if(value=cache[i],loaded=_this.klass.load(_this.endpoint,value),callback(loaded,index++,_this._count)===!1)return!1;return!0}}(this),fetch=function(_this){return function(offset){return offset===_this._offset&&_this._cache&&dispatch(_this._cache)===!1||_this._count&&_this._cache.length>=_this._count?void 0:_this.endpoint.get(_this.params({offset:offset})).then(function(response){return _this._count=parseInt(response.headers["x-total-count"]),dispatch(response.body)&&206===response.status?fetch(offset+MAX_LIMIT):void 0})}}(this),fetch(this._offset),this},Collection.prototype.first=function(count){return null==count&&(count=1),new TicketingHub.Promise(function(_this){return function(resolve,reject){var values;return values=[],_this.limit(Math.min(MAX_LIMIT,count)).each(function(value,index){return index===count-1?(resolve(values),!1):void 0})}}(this))},Collection.prototype.all=function(){return this.reload().then(function(_this){return function(){return new TicketingHub.Promise(function(resolve,reject){var values;return values=[],_this.each(function(value,index,count){return values.push(value),index===count-1?resolve(values):void 0}),0===_this._count?resolve(values):void 0})}}(this))},Collection.prototype.scope=function(path){return new Collection(this.endpoint.join(path),this.klass,this._params)},Collection.prototype.limit=function(value){return null==value?this._limit:new Collection(this.endpoint,this.klass,this.params({limit:parseInt(value)}))},Collection.prototype.offset=function(value){return null==value?this._offset:new Collection(this.endpoint,this.klass,this.params({offset:parseInt(value)}))},Collection.prototype.filter=function(filters){return new Collection(this.endpoint,this.klass,this.params({filters:filters}))},Collection.prototype.count=function(){return new TicketingHub.Promise(function(_this){return function(resolve,reject){return _this._count?resolve(_this._count):_this.reload().then(function(){return resolve(_this._count)})}}(this))},ref=["get","post","patch","delete"],fn=function(method){return Collection.prototype[method]=function(){var args,ref1;return args=1<=arguments.length?slice.call(arguments,0):[],(ref1=this.endpoint)[method].apply(ref1,args).then(function(response){return response.body})}},i=0,len=ref.length;len>i;i++)method=ref[i],fn(method);return Collection.prototype.create=function(attributes){return this.endpoint.post(attributes).then(function(_this){return function(response){return _this.klass.load(_this.endpoint,response.body)}}(this))["catch"](function(_this){return function(error){throw error instanceof TicketingHub.RequestError||422===error.response.status?new TicketingHub.ValidationError(_this.klass.load(_this.endpoint,error.response.body)):error}}(this))},Collection.prototype.reload=function(params){return this.endpoint.get(this.params(params)).then(function(_this){return function(response){return _this._cache=response.body,_this._count=206===status?parseInt(response.headers["x-total-count"]):_this._cache.length,_this}}(this))},Collection.prototype.params=function(params){return extend(extend({},this._params),params||{})},Collection}(EventEmitter)},{"./ticketinghub":29,"./util":30,events:1}],24:[function(require,module,exports){(function(global){var Endpoint,Response,TicketingHub,extend,util;extend=require("./util").extend,Response=require("./response"),util=require("./util"),TicketingHub=require("./ticketinghub"),Endpoint=function(){function Endpoint(origin,path1,auth1){this.origin=origin,this.path=null!=path1?path1:"",this.auth=null!=auth1?auth1:"",this.url=""+this.origin+this.path}var RETRIES,TIMEOUT,fn,i,len,method,ref;for(module.exports=Endpoint,TIMEOUT=3e4,RETRIES=3,Endpoint.prototype.base=function(path,auth){return null==auth&&(auth=this.auth),new Endpoint(this.origin,path,auth)},Endpoint.prototype.join=function(path,auth){return null==auth&&(auth=this.auth),new Endpoint(this.origin,this.path+"/"+path,auth)},ref=["get","post","patch","delete"],fn=function(method){return Endpoint.prototype[method]=function(path,params){var ref1;return"string"!=typeof path&&(ref1=[params,path],path=ref1[0],params=ref1[1]),this.request(method,path,params)}},i=0,len=ref.length;len>i;i++)method=ref[i],fn(method);return Endpoint.prototype.request=function(method,path,params){var id;return null==path&&(path=""),id=util.generateUUID(),new TicketingHub.Promise(function(_this){return function(resolve,reject){var agent,callback,handle,json_params,options,parts,query,req,script,sibling,timeout;return parts=util.parseURL("/"===path[0]?_this.origin+"/"+path:_this.url+"/"+path),json_params=encodeURIComponent(TicketingHub.JSON.stringify(params||{})),query="?_id="+id+"&_json="+json_params+"&_method="+method.toLowerCase(),handle=function(response){var ref1,ref2;return 400<=(ref1=response.status)&&500>ref1?reject(new TicketingHub.RequestError(response)):500<=(ref2=response.status)&&600>ref2?reject(new TicketingHub.ServerError(response)):resolve(response)},"XMLHttpRequest"in global?(callback="_jsonp_"+id.replace(/-/g,""),script=document.createElement("script"),script.async=!0,script.src=parts.href+".json"+query+"&_token="+_this.auth+"&_callback="+callback,timeout=setTimeout(function(){try{script.parentNode.removeChild(script)}catch(_error){}return global[callback]=function(){},reject(new TicketingHub.ConnectionError("Request timed out."))},TIMEOUT),global[callback]=function(body,status,headers){return clearTimeout(timeout),global[callback]=function(){},script.parentNode.removeChild(script),handle(new Response(status,body,headers))},sibling=document.getElementsByTagName("script")[0],sibling.parentNode.insertBefore(script,sibling)):(options={method:"GET",scheme:parts.protocol.slice(0,-1),host:parts.hostname,port:parts.port,auth:_this.auth+":",path:""+parts.path+query},agent=require(parts.protocol.slice(0,-1)),req=agent.request(options,function(res){var data;return data="",res.on("data",function(chunk){return data+=chunk}),res.on("end",function(){return 0!==res.statusCode?handle(new Response(res.statusCode,data,res.headers)):void 0})}),req.setTimeout(TIMEOUT,function(){return reject(new TicketingHub.ConnectionError("Request timed out."))}),req.on("error",function(error){return reject(new TicketingHub.ConnectionError(error.message))}),req.end())}}(this))},Endpoint}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./response":28,"./ticketinghub":29,"./util":30}],25:[function(require,module,exports){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;exports.RequestError=function(superClass){function RequestError(response){this.response=response,this.name="RequestError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,RequestError)}return extend(RequestError,superClass),RequestError}(Error),exports.ServerError=function(superClass){function ServerError(response){this.response=response,this.name="ServerError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,ServerError)}return extend(ServerError,superClass),ServerError}(Error),exports.ConnectionError=function(superClass){function ConnectionError(message){this.message=message,this.name="ConnectionError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,ConnectionError)}return extend(ConnectionError,superClass),ConnectionError}(Error),exports.ValidationError=function(superClass){function ValidationError(resource){this.resource=resource,this.name="ValidationError",this.message="Resource is invalid.","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,ValidationError)}return extend(ValidationError,superClass),ValidationError}(Error)},{}],26:[function(require,module,exports){(function(global){module.exports=require("./ticketinghub"),"undefined"!=typeof global.window&&(global.window.TicketingHub=module.exports)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./ticketinghub":29}],27:[function(require,module,exports){var Collection,EventEmitter,Resource,TicketingHub,extend,util,extend1=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,slice=[].slice;extend=require("./util").extend,util=require("./util"),Collection=require("./collection"),EventEmitter=require("events").EventEmitter,TicketingHub=require("./ticketinghub"),Resource=function(superClass){function Resource(_endpoint,attributes){var listening;this._endpoint=_endpoint,Resource.__super__.constructor.call(this),this._setup(attributes),listening=!1,this.updated_at&&(this.on("removeListener",function(_this){return function(event){return 0===EventEmitter.listenerCount(_this,"change")?listening=!1:void 0}}(this)),this.on("newListener",function(_this){return function(event){var retry,updated_at;if(!listening)return"change"===event?(listening=!0,updated_at=_this.updated_at,retry=function(){return listening?_this.reload().then(function(){return updated_at!==_this.updated_at&&(updated_at=_this.updated_at,_this.emit("change",_this)),setTimeout(retry,util.timeDecay(util.parseISO8601DateTime(_this.updated_at)))}):void 0},setTimeout(retry,util.timeDecay(util.parseISO8601DateTime(_this.updated_at)))):void 0}}(this)))}return extend1(Resource,superClass),module.exports=Resource,Resource.collection=function(key,klass){return this.prototype[key]=function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],"string"==typeof args[0]?(ref=this._endpoint).get.apply(ref,[klass.path+"/"+args[0]].concat(slice.call(args.slice(1)))).then(function(_this){return function(response){return klass.load(_this._endpoint,response.body)}}(this)):new Collection(this._endpoint.join(key),klass,args[0])}},Resource.association=function(key,klass){return this.prototype[key+"="]=function(attributes){return this[key]=klass.load(this._endpoint,attributes)}},Resource.types=function(hash){return this._types=hash},Resource.load=function(endpoint,attributes){var callback,path,ref,ref1,type;return"function"==typeof attributes&&(ref=[attributes,callback],callback=ref[0],attributes=ref[1]),type=(null!=(ref1=this._types)?ref1[attributes.type]:void 0)||this,path=this.singleton?type.path:type.path+"/"+attributes.id,endpoint=endpoint.base(path),new type(endpoint,attributes)},Resource.prototype["delete"]=function(params){return this._endpoint["delete"](params).then(function(_this){return function(response){return _this._setup(response.body)}}(this))},Resource.prototype.update=function(attributes){return this._endpoint.patch(attributes).then(function(_this){return function(response){return _this._setup(response.body)}}(this))["catch"](function(_this){return function(error){throw error instanceof TicketingHub.RequestError||422===error.response.status?new TicketingHub.ValidationError(_this.constructor.load(_this._endpoint,error.response.body)):error}}(this))},Resource.prototype.reload=function(){return this._endpoint.get().then(function(_this){return function(response){return _this._setup(response.body)}}(this))},Resource.prototype._setup=function(params){var key,value;for(key in params)value=params[key],key+"="in this?this[key+"="](value):this[key]=value;return this},Resource}(EventEmitter)},{"./collection":23,"./ticketinghub":29,"./util":30,events:1}],28:[function(require,module,exports){var Response,TicketingHub;TicketingHub=require("./ticketinghub"),Response=function(){function Response(status,body,headers){var key,value;this.status=status,null==body&&(body=""),null==headers&&(headers={}),this.headers={};for(key in headers)value=headers[key],this.headers[key.toLowerCase()]=value;/json/.test(this.headers["content-type"])&&(body=TicketingHub.JSON.parse(body)),this.body=body}return module.exports=Response,Response}()},{"./ticketinghub":29}],29:[function(require,module,exports){var ConnectionError,Endpoint,RequestError,ServerError,TicketingHub,ValidationError,ref;ref=require("./errors"),RequestError=ref.RequestError,ServerError=ref.ServerError,ConnectionError=ref.ConnectionError,ValidationError=ref.ValidationError,TicketingHub=function(){function TicketingHub(){}return module.exports=TicketingHub,TicketingHub.Channel=require("./channel/channel"),TicketingHub.Promise=require("yaku"),TicketingHub.JSON=require("json3"),TicketingHub.RequestError=RequestError,TicketingHub.ServerError=ServerError,TicketingHub.ConnectionError=ConnectionError,TicketingHub.ValidationError=ValidationError,TicketingHub.TicketingHub=TicketingHub,TicketingHub}(),Endpoint=require("./endpoint"),TicketingHub.endpoint=new Endpoint("https://api.ticketinghub.com")},{"./channel/channel":8,"./endpoint":24,"./errors":25,json3:2,yaku:3}],30:[function(require,module,exports){(function(global){exports.parseISO8601DateTime=function(s){var a,d,i,ms,offset,re;if(re=/(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)(\.\d+)?(Z|([+-])(\d\d):(\d\d))/,d=s.match(re),!d)throw"Couldn't parse ISO 8601 date string '"+s+"'";a=[1,2,3,4,5,6,10,11];for(i in a)d[a[i]]=parseInt(d[a[i]],10);return d[7]=parseFloat(d[7]),ms=Date.UTC(d[1],d[2]-1,d[3],d[4],d[5],d[6]),d[7]>0&&(ms+=Math.round(1e3*d[7])),"Z"!==d[8]&&d[10]&&(offset=60*d[10]*60*1e3,d[11]&&(offset+=60*d[11]*1e3),"+"===d[9]?ms-=offset:ms+=offset),new Date(ms)},exports.parseURL=function(str){var a,url;return global.window?(a=document.createElement("a"),a.href=str,{protocol:a.protocol,hostname:a.hostname,port:a.port,pathname:a.pathname,href:a.href}):(url="url",require(url).parse(str))},exports.extend=function(a,b){var key,value;for(key in b)value=b[key],a[key]=value;return a},exports.parseResponseHeaders=function(headerStr){var headerPair,headerPairs,headers,i,index,key,val;if(headers={},!headerStr)return headers;for(headerPairs=headerStr.split("\r\n"),i=0;i<headerPairs.length;)headerPair=headerPairs[i],index=headerPair.indexOf(": "),index>0&&(key=headerPair.substring(0,index),val=headerPair.substring(index+2),headers[key]=val),i++;return headers},exports.generateUUID=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(a){return(a^16*Math.random()>>a/4).toString(16)})},exports.timeDecay=function(_this){return function(date){var seconds;return seconds=(Number(new Date)-Number(date))/1e3,1e3*Math.log(1+seconds,Math.E)}}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[26]);
